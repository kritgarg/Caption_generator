# Caption Generator (Standalone UI)

A simple Speech-to-Text pipeline with:
- **Backend**: Node/Express server that uploads media to AssemblyAI and returns `{ text, words[] }`.
- **Frontend (Standalone UI)**: Vite + React app to upload a video, auto-generate captions, preview styles, download SRT, and download captioned MP4.
- **Frontend (Remotion demo, optional)**: Remotion project to preview and render captions inside Remotion Studio or CLI.

Key paths:
- Backend: `backend/`
- Standalone UI: `frontend/standalone/`
- Remotion demo (optional): `frontend/remotion-caption-demo/`

---

## Prerequisites
- Node.js 18+
- An AssemblyAI API key: https://www.assemblyai.com/

---

## Backend Setup (`backend/`)

1. **Install dependencies**
   ```bash
   cd backend
   npm install
   ```

2. **Configure API key**
   - Export the key in your shell before starting the server (recommended):
     ```bash
     export ASSEMBLY_API_KEY=YOUR_ASSEMBLYAI_API_KEY
     ```
   - Alternatively, you can hardcode the key in `backend/server.js` (not recommended for production).

3. **Start the server**
   ```bash
   node server.js
   # or, if you prefer auto-reload:
   npx nodemon server.js
   ```
   The server runs at `http://localhost:3001`.

### Test transcription via curl
Send an `.mp4` (or audio) file as `video` form field to `/transcribe`.

```bash
curl -X POST \
  -F "video=@/absolute/path/to/video.mp4" \
  http://localhost:3001/transcribe
```

Expected JSON:
```json
{
  "text": "... full transcript ...",
  "words": [
    { "start": 120, "end": 450, "text": "Hello" },
    { "start": 460, "end": 800, "text": "world" }
  ]
}
```

> Note: `start`/`end` are in milliseconds.

---

## Frontend Standalone Setup (`frontend/standalone/`)

1. **Install dependencies**
   ```bash
   cd frontend/standalone
   npm install
   ```

2. **Start the app**
   ```bash
   npm run dev
   ```
   The app runs at `http://localhost:5173` (Vite default). Ensure the backend is running at `http://localhost:3001`.

3. **Use the UI**
   - Click “Select MP4” and choose a local `.mp4` file.
   - Click “Auto-generate captions” to send the video to the backend and AssemblyAI.
   - Choose a caption style: `bottom`, `top`, or `karaoke`.
   - Click “Download SRT” to export subtitles.
   - Click “Download MP4” to render a captioned video (this calls the backend `/render`, which uses the Remotion project under `frontend/remotion-caption-demo/`).

> Tip: The UI prefers the server-accessible video URL returned by the backend for consistent preview and rendering.

---

## Frontend Setup (Remotion demo, optional) (`frontend/remotion-caption-demo/`)

1. **Install dependencies**
   ```bash
   cd frontend/remotion-caption-demo
   npm install
   ```

2. **Start Remotion Studio (dev)**
   ```bash
   npm run dev
   ```
   This opens Remotion Studio. You should see a composition named `CaptionDemo`.

---

## How to Preview Captions

There are two primary ways:

- **A) Standalone UI (recommended)**
  - Run the backend.
  - Run the standalone UI at `frontend/standalone/` and follow the on-screen flow (upload → generate → preview → export).

- **B) Remotion Studio input props (optional)**
  1. Start the backend (`http://localhost:3001`).
  2. Start Remotion Studio (`npm run dev` in `frontend/remotion-caption-demo/`).
  3. Select the `CaptionDemo` composition.
  4. In the right-side panel, edit `inputProps` with `videoSrc`, `preset`, and `words`.

> Captions rendering is implemented in `src/components/Captions.jsx`.
> Font used: `Noto Sans Devanagari, Noto Sans, sans-serif`. Include webfonts if not installed.

---

## Render an MP4

You can render from the Standalone UI by clicking “Download MP4”. This calls the backend `/render` route, which invokes Remotion to render the `CaptionDemo` composition using the props generated by the UI.

### Using Remotion CLI (optional)

You can render `CaptionDemo` headlessly using `npx remotion render`.

1. From the frontend folder:
   ```bash
   cd frontend/remotion-caption-demo
   ```

2. Prepare props (either inline JSON or a JSON file). Example `props.json`:
   ```json
   {
     "videoSrc": "https://example.com/video.mp4",
     "preset": "karaoke",
     "words": [
       { "start": 0, "end": 500, "text": "Hello" },
       { "start": 500, "end": 1000, "text": "world" }
     ]
   }
   ```

3. Render:
   ```bash
   npx remotion render \
     CaptionDemo \
     out.mp4 \
     --props=props.json
   ```

- To pass props inline without a file:
  ```bash
  npx remotion render \
    CaptionDemo \
    out.mp4 \
    --props='{"videoSrc":"https://example.com/video.mp4","preset":"bottom","words":[{"start":0,"end":500,"text":"Hello"}]}'
  ```

> Duration is computed dynamically from `videoSrc` metadata at render time; if metadata isn’t accessible, it falls back to 60s.

---

## Troubleshooting
- **CORS**: If calling the backend from the browser, you may need to enable CORS on `backend/server.js` or run both on the same origin/proxy.
- **Large uploads**: AssemblyAI upload may take time. Watch the backend logs for progress and polling.
- **Fonts**: Ensure `Noto Sans Devanagari` and `Noto Sans` are available or included via CSS/webfonts for best caption appearance.
- **Composition ID**: Ensure you are using `CaptionDemo` (registered in `src/index.jsx`).
